---
layout: post
title: '[ê²Œì‹œíŒ ë§Œë“¤ê¸°] TIL 7. My page, Edit User Info'
date: 2021-09-07 21:18:44 +0900
subtitle: 'Wiki'
categories: DEVLOG
tags: Notice_Board
comments: true
toc: true
---

> 1. clearCookie
> 
> 2. JWT í† í° ê²€ì¦ (`jwt.verify()`)

<br>

ğŸ˜€ [Notice Board ë ˆíŒŒì§€í† ë¦¬](https://github.com/riverpark94/Notice_Board)ğŸ˜€ <br>Stack : Javascript, express, nodejs, sequelize
{: .notice--warning}

<br>

â˜… : ì´ë²ˆ ê³¼ì •ì„ í†µí•´ì„œ ìƒˆë¡œ ë§Œë“¤ì–´ì§„ íŒŒì¼

â˜† : ì´ë²ˆ ê³¼ì •ì„ í†µí•´ì„œ ìˆ˜ì •ëœ íŒŒì¼

```
/
â”œâ”€â”€ ğŸ“/server
â”‚   â”œâ”€â”€ ğŸ“„README.md                     # Notice_Board README.md íŒŒì¼
â”‚   â”œâ”€â”€ ğŸ“„index.js                      # node.jsë¡œ ì‘ì„±ëœ ì›¹ ì„œë²„ ì§„ì…ì 
â”‚   â”œâ”€â”€ ğŸ“„package.json
â”‚   â”œâ”€â”€ ğŸ“„package-lock.json
â”‚   â”œâ”€â”€ ğŸ“„.gitignore                    # node_modules, env ë“± í¬í•¨ë˜ì§€ ì•Šê²Œ ì„¤ì •ìš”ë§
â”‚   â”œâ”€â”€ ğŸ“/config                       # í™˜ê²½ë³€ìˆ˜
â”‚   â”‚    â”œâ”€â”€ ğŸ“„config.js        
â”‚   â”‚    â””â”€â”€ ğŸ“„jwt.js                   # jwt ê´€ë ¨ í™˜ê²½ë³€ìˆ˜
â”‚   â”œâ”€â”€ ğŸ“/controllers                  # ê¸°ëŠ¥ API
â”‚   â”‚    â”œâ”€â”€ ğŸ“„â˜† index.js        
â”‚   â”‚    â”œâ”€â”€ ğŸ“User                     # ìœ ì €ê´€ë ¨ API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„index.js 
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„join.js             # join API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„login.js            # login API
â”‚   â”‚    â”‚    â””â”€â”€ ğŸ“„logout.js           # logout API
â”‚   â”‚    â””â”€â”€ ğŸ“MyPage                   # ë§ˆì´í˜ì´ì§€ API
â”‚   â”‚         â”œâ”€â”€ ğŸ“„â˜… index.js 
â”‚   â”‚         â”œâ”€â”€ ğŸ“„â˜… myPage.js        # myPage API
â”‚   â”‚         â””â”€â”€ ğŸ“„â˜… editUserInfo.js  # editUserInfo API
â”‚   â”œâ”€â”€ ğŸ“/middlewares
â”‚   â”‚    â”œâ”€â”€ ğŸ“„CheckEmailForm.js        # email ì–‘ì‹ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” middleware
â”‚   â”‚    â”œâ”€â”€ ğŸ“„CheckPassword.js         # password ì¡°ê±´ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” middleware      
â”‚   â”‚    â””â”€â”€ ğŸ“„checkToken.js            # â˜… JWT ê²€ì¦ middleware
â”‚   â”œâ”€â”€ ğŸ“/migrations 
â”‚   â”‚    â”œâ”€â”€ ğŸ“„20210819052749-create-users.js
â”‚   â”‚    â””â”€â”€ ğŸ“„20210819065842-add-column-in-usersTable.js          
â”‚   â”œâ”€â”€ ğŸ“/models                       # DB ëª¨ë¸ íŒŒì¼
â”‚   â”‚    â”œâ”€â”€ ğŸ“„index.js
â”‚   â”‚    â””â”€â”€ ğŸ“„users.js
â”‚   â”œâ”€â”€ ğŸ“/routes
â”‚        â””â”€â”€ ğŸ“„â˜† index.js               # ë¶„ê¸° íŒŒì¼
â”‚   
```

<br>

**/controllers/MyPage/myPage.js**

```js
const { Users } = require('../../models');
require('dotenv').config();

module.exports = {
  get : async (req, res) =>{
    const email = req.user;

    Users.findOne({
      where : {email}
    })
    .then(data => {
      res
        .status(201)
        .send({
          user : {
            email : data.email,
            nickname : data.nickname
          }
        })
    })
  }
}
```

**/controllers/MyPage/editUserInfo.js**

```js
const { Users } = require('../../models');
require('dotenv').config();

module.exports = {
  put : async (req, res) =>{
    const { nickname } = req.body;
    const email = req.user;

    Users.update({
        nickname
      },{
        where: {email}
      })
      .then(data => {
        console.log(data)
        res.status(200).send(data)
      });
  }
}
```

**/controllers/MyPage/index.js**

```js
module.exports = {
  myPage : require("./myPage"),
  editUserInfo : require("./editUserInfo"),
}
```

**/routes/index.js**

```js
const express = require('express');
const router = express.Router();

const checkToken = require('../middlewares/checkToken');
const { userController, myPageController } = require('../controllers');


router.get('/', (req, res) => {
  res.send("Site access success");
});

router.post('/user/join', userController.join.post);
router.post('/user/login', userController.login.post);

router.use(checkToken);
router.post('/user/logout', userController.logout.post);
router.get('/user/myPage', myPageController.myPage.get);
router.put('/user/myPage', myPageController.editUserInfo.put);

module.exports = router;
```

<br>

# 1. controllers

## 1.1 My Page

**/controllers/MyPage/myPage.js**

```js
const { Users } = require('../../models');
require('dotenv').config();

module.exports = {
  get : async (req, res) =>{
    const email = req.user;

    Users.findOne({
      where : {email}
    })
    .then(data => {
      res
        .status(201)
        .send({
          user : {
            email : data.email,
            nickname : data.nickname
          }
        })
    })
  }
}
```

ì–´ì œ JWT í† í° ê²€ì¦ì„ í•˜ë©´ì„œ Decodedí•´ì„œ ì–»ì€ PayLoadì˜ ê°’, emailì„ `req.user`ì— ì €ì¥í–ˆë‹¤. ì´ ì´ë©”ì¼ì€ ì¸ì¦ì´ í•„ìš”í•œ í˜ì´ì§€ì—ì„œ í™œìš©í•  ìˆ˜ ìˆë‹¤. mypageëŠ” ë³´í†µ íšŒì›ê°€ì… ì‹œ ì…ë ¥í–ˆë˜ ì •ë³´ë¥¼ ì¶œë ¥í•œë‹¤. ë•Œë¬¸ì— Users DBì—ì„œ ë¡œê·¸ì¸í•œ ê³ ê°ì˜ ì •ë³´ë¥¼ ê²€ìƒ‰í•´ ê°€ì§€ê³  ì™€ì•¼ í•˜ëŠ”ë° ì´ë•Œ, `req.user`ì— ì €ì¥ëœ emailê°’ê³¼`findOne`ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ í•´ê²°ëœë‹¤.

## 1.2 Edit User Info

**/controllers/MyPage/editUserInfo.js**

```js
const { Users } = require('../../models');
require('dotenv').config();

module.exports = {
  put : async (req, res) =>{
    const { nickname } = req.body;
    const email = req.user;

    Users.update({
        nickname
      },{
        where: {email}
      })
      .then(data => {
        console.log(data)
        res.status(200).send(data)
      });
  }
}
```

sequelizeì—ì„œ Users DBì— ìˆëŠ” ë‚´ìš©ì„ ìˆ˜ì •í•˜ê¸° ìœ„í•´ì„œëŠ” `update` ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ì²« ë²ˆì§¸ ì¸ìë¡œëŠ” ìˆ˜ì •í•  ë‚´ìš©ì„, ë‘ ë²ˆì§¸ ì¸ìë¡œëŠ” ê²€ìƒ‰í•  ì¹¼ëŸ¼ê³¼ ê²€ìƒ‰ì–´ë¥¼ ë„£ëŠ”ë‹¤.

<br>

# 2. ë¼ìš°í„°

**/routes/index.js**

```js
const express = require('express');
const router = express.Router();

const checkToken = require('../middlewares/checkToken');
const { userController, myPageController } = require('../controllers');


router.get('/', (req, res) => {
  res.send("Site access success");
});

router.post('/user/join', userController.join.post);
router.post('/user/login', userController.login.post);

router.use(checkToken);
router.post('/user/logout', userController.logout.post);
router.get('/user/myPage', myPageController.myPage.get);
router.put('/user/myPage', myPageController.editUserInfo.put);

module.exports = router;
```

ë¼ìš°í„° íŒŒì¼ì„ ë³´ë©´ `post`, `put`, `get` ë“±ì˜ ë©”ì†Œë“œê°€ ì“°ì¸ ê²ƒì„ ì•Œ ê²ƒì´ë‹¤. 

ëŒ€ë¶€ë¶„ì˜ ì»´í“¨í„° ì†Œí”„íŠ¸ì›¨ì–´ê°€ ê°€ì§€ëŠ” ê¸°ë³¸ì ì¸ ë°ì´í„° ì²˜ë¦¬ ê¸°ëŠ¥ì€ 4ê°€ì§€ê°€ ìˆë‹¤. ì´ê²ƒì„ **CRUD(í¬ëŸ¬ë“œ)**ë¼ê³  í•˜ëŠ”ë°, **Create, Read, Update, Deleteì˜ ì•½ì–´**ì´ë‹¤. ì°¨ë¡€ëŒ€ë¡œ ë°ì´í„°ì˜ ìƒì„±, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œì— ëŒ€í•œ ê¸°ëŠ¥ì´ë‹¤. ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ê²ƒ ì¤‘ íšŒì›ê°€ì…ì´ Create, ë¡œê·¸ì¸ê³¼ My pageê°€ Readì— í•´ë‹¹í•œë‹¤.  ì§€ê¸ˆ í•  íšŒì›ì •ë³´ ìˆ˜ì •ì´ Updateì— í•´ë‹¹í•  ê²ƒì´ë‹¤. ì•ìœ¼ë¡œ ë°°ìš¸ ê²Œì‹œê¸€ ì‚­ì œì™€ ëŒ“ê¸€ ì‚­ì œëŠ” Deleteì— í•´ë‹¹í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. [TIL3 ì—ì„œ HTTP ìš”ì²­ ë©”ì†Œë“œ](https://riverpark94.github.io/devlog/2021/08/18/NB-TIL3/#12-appmethod%EA%B2%BD%EB%A1%9C-%EC%BD%9C%EB%B0%B1--%EC%BD%9C%EB%B0%B1-)ì— ëŒ€í•´ì„œ ì ê¹ ì–¸ê¸‰í•œ ì ì´ ìˆì„ ê²ƒì´ë‹¤. CRUDì™€ ì´ HTTP ìš”ì²­ ë©”ì†Œë“œë¥¼ ëŒ€ì…í•´ë³´ë©´ Createë¥¼ ìœ„í•´ì„œëŠ” `PUT` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ê³ , Readë¥¼ ìœ„í•´ì„œëŠ” `GET` ë©”ì†Œë“œë¥¼, UpdateëŠ” `PUT` ë©”ì†Œë“œë¥¼, DeleteëŠ” `DELECT` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë  ê²ƒì´ë‹¤.





