---
layout: post
title: '[ê²Œì‹œíŒ ë§Œë“¤ê¸°] TIL 10. Get/veiw/Edit/Delete Post'
date: 2021-09-16 21:18:44 +0900
subtitle: 'Wiki'
categories: DEVLOG
tags: Notice_Board
comments: true
toc: true
---

> 1. include 
> 
> 2. exclude 

<br>

ğŸ˜€ [Notice Board ë ˆíŒŒì§€í† ë¦¬](https://github.com/riverpark94/Notice_Board)ğŸ˜€ <br>Stack : Javascript, express, nodejs, sequelize
{: .notice--warning}

<br>

â˜… : ì´ë²ˆ ê³¼ì •ì„ í†µí•´ì„œ ìƒˆë¡œ ë§Œë“¤ì–´ì§„ íŒŒì¼

â˜† : ì´ë²ˆ ê³¼ì •ì„ í†µí•´ì„œ ìˆ˜ì •ëœ íŒŒì¼

```
/
â”œâ”€â”€ ğŸ“/server
â”‚   â”œâ”€â”€ ğŸ“„README.md                     # Notice_Board README./
â”œâ”€â”€ ğŸ“/server
â”‚   â”œâ”€â”€ ğŸ“„README.md                     # Notice_Board README.md íŒŒì¼
â”‚   â”œâ”€â”€ ğŸ“„index.js                      # node.jsë¡œ ì‘ì„±ëœ ì›¹ ì„œë²„ ì§„ì…ì 
â”‚   â”œâ”€â”€ ğŸ“„package.json
â”‚   â”œâ”€â”€ ğŸ“„package-lock.json
â”‚   â”œâ”€â”€ ğŸ“„.gitignore                    # node_modules, env ë“± í¬í•¨ë˜ì§€ ì•Šê²Œ ì„¤ì •ìš”ë§
â”‚   â”œâ”€â”€ ğŸ“/config                       # í™˜ê²½ë³€ìˆ˜
â”‚   â”‚    â”œâ”€â”€ ğŸ“„config.js        
â”‚   â”‚    â””â”€â”€ ğŸ“„jwt.js                   # jwt ê´€ë ¨ í™˜ê²½ë³€ìˆ˜
â”‚   â”œâ”€â”€ ğŸ“/controllers                  # ê¸°ëŠ¥ API
â”‚   â”‚    â”œâ”€â”€ ğŸ“„â˜† index.js        
â”‚   â”‚    â”œâ”€â”€ ğŸ“User                     # ìœ ì €ê´€ë ¨ API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„index.js 
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„join.js             # join API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„login.js            # login API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„logout.js           # logout API
â”‚   â”‚    â”‚    â””â”€â”€ ğŸ“„withdrawal.js    # withdrawal API
â”‚   â”‚    â”œâ”€â”€ ğŸ“MyPage                   # ë§ˆì´í˜ì´ì§€ API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„index.js 
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„myPage.js            # myPage API
â”‚   â”‚    â”‚    â””â”€â”€ ğŸ“„editUserInfo.js      # editUserInfo API
â”‚   â”‚    â””â”€â”€ ğŸ“Boards                   # ê²Œì‹œíŒ API
â”‚   â”‚         â”œâ”€â”€ ğŸ“„â˜† index.js 
â”‚   â”‚         â”œâ”€â”€ ğŸ“„writeBoard.js        # writeBoard API
â”‚   â”‚         â”œâ”€â”€ ğŸ“„searchBords.js       # writeBoard API
â”‚   â”‚         â”œâ”€â”€ ğŸ“„â˜… getBoards.js      # getBoards API
â”‚   â”‚         â”œâ”€â”€ ğŸ“„â˜… viewBoard.js      # viewBoard API\
â”‚   â”‚         â””â”€â”€ ğŸ“„â˜… editBoard.js      # editBoard API
â”‚   â”‚         â””â”€â”€ ğŸ“„â˜… deleteBoard.js    # deleteBoard API
â”‚   â”œâ”€â”€ ğŸ“/middlewares
â”‚   â”‚    â”œâ”€â”€ ğŸ“„CheckEmailForm.js        # email ì–‘ì‹ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” middleware
â”‚   â”‚    â”œâ”€â”€ ğŸ“„CheckPassword.js         # password ì¡°ê±´ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” middleware      
â”‚   â”‚    â””â”€â”€ ğŸ“„checkToken.js            # JWT ê²€ì¦ middleware
â”‚   â”œâ”€â”€ ğŸ“/migrations 
â”‚   â”‚    â”œâ”€â”€ ğŸ“„20210819052749-create-users.js
â”‚   â”‚    â”œâ”€â”€ ğŸ“„20210819065842-add-column-in-usersTable.js   
â”‚   â”‚    â”œâ”€â”€ ğŸ“„20210910065541-create-boards.js
â”‚   â”‚    â””â”€â”€ ğŸ“„20210910070528-fk-Boards.js         
â”‚   â”œâ”€â”€ ğŸ“/models                       # DB ëª¨ë¸ íŒŒì¼
â”‚   â”‚    â”œâ”€â”€ ğŸ“„index.js
â”‚   â”‚    â”œâ”€â”€ ğŸ“„users.js
â”‚   â”‚    â””â”€â”€ ğŸ“„boards.js
â”‚   â”œâ”€â”€ ğŸ“/routes
â”‚        â””â”€â”€ ğŸ“„â˜† index.js               # ë¶„ê¸° íŒŒì¼
â”‚   
```

<br>

**controllers/Boards/getBoards.js**

```js
const { Boards } = require('../../models');
const { Users } = require('../../models');

module.exports = {
  get : async (req, res) =>{
    Boards.findAll({
      order: [['createdAt', 'DESC']],
      attributes :{exclude :["content"]},
      include : [
        { model : Users, 
          required: true, 
          attributes : {exclude :["id","email","password", "salt", "createdAt", "updatedAt"]} }
      ]
    }).then(data => {
        res.status(200).send(data)
    })
  }
}
```

<br>

user APIë“¤ê³¼ ê²¹ì¹˜ëŠ” ë¶€ë¶„ì´ ë§ì•„ ì–´ë ¤ìš´ ì ì€ ì—†ì—ˆìœ¼ë‚˜, í•´ë‹¹ ê¸°ëŠ¥ì„ ì‘ì„±í•˜ë©´ì„œ` include`ì™€ `exclude` ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì˜€ê¸° ë•Œë¬¸ì— ê·¸ì— ëŒ€í•œ ì„¤ëª…ì„ ì •ë¦¬í•œë‹¤. 

<br>

# 1. `include`ì™€ `exclude` 

**controllers/Boards/getBoards.js**

```js
const { Boards } = require('../../models');
const { Users } = require('../../models');

module.exports = {
  get : async (req, res) =>{
    Boards.findAll({
      order: [['createdAt', 'DESC']],
      attributes :{exclude :["content"]},
      include : [
        { model : Users, 
          required: true, 
          attributes : {exclude :["id","email","password", "salt", "createdAt", "updatedAt"]} }
      ]
    }).then(data => {
        res.status(200).send(data)
    })
  }
}
```

13ì¼ ì ì‘ì„±í•œ ì½”ë“œë¥¼ ë³´ë©´ì„œ í•œê°€ì§€ ë†“ì¹œ ê²Œ ìˆë‹¤ëŠ” ì‚¬ì‹¤ ê¹¨ë‹¬ì•˜ë‹¤. ë„¤ì´ë²„ ì¹´í˜ì—ì„œ ê²€ìƒ‰í•˜ë©´ ë‚˜ì˜¤ëŠ” ì •ë³´ëŠ” **í¬ìŠ¤íŠ¸ ì´ë¦„**, **ì‘ì„±ì ì´ë¦„**, **ì‘ì„± ì‹œê°„**, **ì¢‹ì•„ìš”ë‚˜ ì¡°íšŒ ìˆ˜**, **ëŒ“ê¸€ ê°œìˆ˜**ê°€ ë‚˜ì˜¨ë‹¤. ëŒ“ê¸€ ê°œìˆ˜ëŠ” ìƒê°í–ˆë˜ ê²ƒì´ ì•„ë‹ˆë‹ˆê¹Œ Reply APIë¥¼ ë§Œë“¤ ë•Œ ì¹¼ëŸ¼ì„ ì¶”ê°€í• ì§€ ë§ì§€ì— ëŒ€í•´ì„œ ê³ ë¯¼í•´ë³´ë„ë¡ í•˜ê³ . ì–´ì œ ìë¡œ ì•Œì•„ë´¤ë˜ ê±´ **ì‘ì„±ì ì´ë¦„**ì´ì˜€ê³ , ì˜¤ëŠ˜ ìë¡œ ì•Œì•„ë³¸ ê²ƒì€ ì‘ë‹µ ê°ì²´(res)ì— ë¶ˆí•„ìš”í•œ ì •ë³´ë¥¼ ëœì–´ë‚´ëŠ” ê²ƒì´ì—ˆë‹¤.

## 1.1 `include`

> ê³µì‹ ë ˆí¼ëŸ°ìŠ¤ ğŸ‘‰ [https://sequelize.org/master/manual/eager-loading.html](https://sequelize.org/master/manual/eager-loading.html)

ê³µì‹ë¬¸ì„œì—ì„œ ë³´ë©´ Finder í•¨ìˆ˜ëŠ”`include`ì ˆì„ ì‚¬ìš©í•  ì‹œ, SQLë¬¸ì˜ Joinê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ë§Œë“ ë‹¤ê³  í•œë‹¤. ì´ í•¨ìˆ˜ì˜ ê¸°ë³¸ê°’ì€ `outer join`ì´ê¸° ë•Œë¬¸ì—, ë§Œì•½ `inner join`ì˜ ê²°ê³¼ë¥¼ ë°”ë€ë‹¤ë©´, `required:true`ë¥¼ `include`ì ˆì˜ ì˜µì…˜ì— ë„£ì–´ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  `where`ê³¼ operators ë˜í•œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤. 

```js
const { Boards } = require('../../models');
const { Users } = require('../../models');

module.exports = {
  get : async (req, res) =>{
    Boards.findAll({
      order: [['createdAt', 'DESC']],
      include : [{ model : Users}]
    }).then(data => {
        res.status(200).send(data)
    })
  }
}
```

`exclude` ì—†ëŠ” ìƒíƒœì—ì„œ ìœ„ì²˜ëŸ¼ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ Boards í…Œì´ë¸”ê³¼ Users í…Œì´ë¸”ì— ìˆëŠ” ëª¨ë“  ë°ì´í„°ê°€ ì¶œë ¥ëœë‹¤. ì¦‰, ë¶ˆí•„ìš”í•œ, í˜¹ì€ ë…¸ì¶œë˜ë©´ ì•ˆ ë˜ëŠ” ì •ë³´ê¹Œì§€ ëª¨ë‘ ë…¸ì¶œëœë‹¤.

```json
[
  {
    "id": 2,
    "userId" : 1,
    "title": "ì œëª©ì…ë‹ˆë‹¤1",
    "content": "ë‚´ìš©ì…ë‹ˆë‹¤2",
    "likes": 0,
    "createdAt": "2021-08-01T06:02:00.000Z",
    "user": {
    	"id" : 1,
    	"email" : "assignment@example.com",
        "nickname": "íŒ¬ë”",
        "password": "abc123",
        "slat": "asdfasgda",
        "createdAt": "2021-08-01T06:02:00.000Z",
        "updatedAt": "2021-08-01T06:02:00.000Z",
    }
  }
]
```

ìœ„ì²˜ëŸ¼ ìš°ë¦¬ì—ê²Œ í•„ìš”í•œ ê²ƒì€ nicknameë¿ì¸ë°, ë‹¤ë¥¸ ë°ì´í„°ë„ ì¶œë ¥ëœë‹¤. íŠ¹íˆ ì—¬ê¸°ì„œëŠ” ë…¸ì¶œë˜ë©´ ì•ˆ ë˜ëŠ” passwordì™€ slat ê°’ì´ ë…¸ì¶œë˜ê³  ìˆë‹¤.

## 1.2 `exclude`

> ê³µì‹ ë ˆí¼ëŸ°ìŠ¤ ğŸ‘‰ [https://sequelize.org/master/manual/model-querying-basics.html](https://sequelize.org/master/manual/model-querying-basics.html)

ì›ë˜ë¼ë©´ í•„ìš”í•œ ì¹¼ëŸ¼ë§Œ ë…¸ì¶œí•˜ëŠ” ë²•ì„ ì°¾ì•˜ëŠ”ë°, ì‰½ê²Œ ë‚˜ì˜¤ì§€ ì•Šì•„ì„œ ë¶ˆí•„ìš”í•œ ì¹¼ëŸ¼ì€ ë°°ì œí•˜ê³  ì¶œë ¥í•  ìˆ˜ ìˆëŠ” `exclude`ë¡œ ëŒ€ì²´í–ˆë‹¤. ë ˆí¼ëŸ°ìŠ¤ì—ëŠ” *Similarly, it's also possible to remove a selected few attributes:*ë¼ê³  ì•„ì£¼ ì§§ê²Œ ì„¤ëª…ë˜ì–´ìˆì–´ì„œ ì¼ë‹¨ ë¬´ì‘ì • ì‹œë„í•´ë³´ì•˜ë‹¤.

```js
const { Boards } = require('../../models');
const { Users } = require('../../models');

module.exports = {
  get : async (req, res) =>{
    Boards.findAll({
      order: [['createdAt', 'DESC']],
      attributes :{exclude :["content", "updatedAt"]},
      include : [
        { model : Users, 
          required: true, 
          attributes : {exclude :["id","email","password", "salt", "createdAt", "updatedAt"]} }
      ]
    }).then(data => {
        res.status(200).send(data)
    })
  }
}
```

Users í…Œì´ë¸”ì—ì„œëŠ” nicknameì„ ë¹¼ê³  ì „ë¶€ ë¶ˆí•„ìš”í•œ ë°ì´í„°ì´ê¸° ë•Œë¬¸ì— nicknameì„ ì œì™¸í•œ ëª¨ë“  ì¹¼ëŸ¼ì„ ë°°ì œí–ˆê³ , Boards í…Œì´ë¸”ì—ì„œëŠ” content ë§Œ í•„ìš”í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨í•˜ì—¬ content ì¹¼ëŸ¼ë§Œ ë°°ì œí•˜ì˜€ë‹¤.

```json
[
  {
    "id": 2,
    "userId" : 1,
    "title": "ì œëª©ì…ë‹ˆë‹¤1",
    "likes": 0,
    "createdAt": "2021-08-01T06:02:00.000Z",
    "user": {
        "nickname": "íŒ¬ë”",
    }
  }
]
```

ì ìš©í•˜ê³ ë‚˜ë©´ ìœ„ì²˜ëŸ¼ ê¹”ë”í•˜ê²Œ ì¶œë ¥ëœë‹¤.

<br>

# 2. ê³ ë¯¼ ì¤‘ì¸ ê²ƒ

**controllers/Boards/editBoard.js**

```js
const { Boards } = require('../../models');
const { Users } = require('../../models');

module.exports = {
  put : async (req, res) =>{
    const { id } = req.params;
    const email = req.user;

    const dbUserId = await Users.findOne({
      where : {
        email
      } 
    }).then(data => data.dataValues.id)

    const dbWriterId = await Boards.findOne({
      where : {
        id
      }
    }).then(data => data.dataValues.userId)

    if(dbUserId != dbWriterId) {
      res.status(400).send("You're not the author of this post.");
    }
    else {
      const {title , content} = req.body;
      
      if(!title && !content){
        Boards.update({},{
          where : { id }
        })
        .then (data => {
          console.log(data)
          res.status(200).send(data)
        })
      }
      else if(title && content) {
        Boards.update({
          title, content
        },{
          where : { id }
        })
        .then (data => {
          console.log(data)
          res.status(200).send(data)
        })
      }
      else {
        if (!title) {
          Boards.update({
            content
          },{
            where : { id }
          })
          .then (data => {
            console.log(data)
            res.status(200).send(data)
          })
        }
        else if (!content) {
          Boards.update({
            title
          },{
            where : { id }
          })
          .then (data => {
            console.log(data)
            res.status(200).send(data)
          })
        }
      }
    }
  }
}
```

í¬ìŠ¤íŠ¸ ìˆ˜ì • APIì— ì¤‘ë³µë˜ëŠ” ë¶€ë¶„ì´ ë„ˆë¬´ ë§ë‹¤... 

```js
Boards
    .update({
        //ì—¬ê¸° ë“¤ì–´ì˜¤ëŠ” ê°’ë§Œ ë‹¤ë¦„.
    },{
        where : { id }
    })
    .then (data => {
        res.status(200).send(data)
    })
```

ì •í™•íˆëŠ” ìœ„ ì½”ë“œê°€ ê° ifë¬¸ì—ì„œ ê²¹ì¹˜ê³  ìˆëŠ”ë°, ì´ê±¸ ë¯¸ë“¤ì›¨ì–´í™” í•˜ê±°ë‚˜, í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì„œ ì¤„ì–´ë³´ê³  ì‹¶ë‹¤... ã…œ
