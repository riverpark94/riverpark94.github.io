---
layout: post
title: '[Notice Board] TIL 3. join ë¼ìš°í„° ë° DB'
date: 2021-08-18 21:18:44 +0900
subtitle: 'Wiki'
categories: DEVLOG
tags: Notice_Board
comments: true
toc: true
---

> 1. ë¼ìš°í„° ë¶„ë¦¬
> 2. Sequelize
> 3. Join API
>    3.1. controllers
>    3.2. middlewares

<br>

ğŸ˜€ [Notice Board ë ˆíŒŒì§€í† ë¦¬](https://github.com/riverpark94/Notice_Board)ğŸ˜€ 
{: .notice--warning}

<br>

```
/
â”œâ”€â”€ ğŸ“/server
â”‚   â”œâ”€â”€ ğŸ“„README.md                     # Notice_Board README.md íŒŒì¼
â”‚   â”œâ”€â”€ ğŸ“„index.js                      # node.jsë¡œ ì‘ì„±ëœ ì›¹ ì„œë²„ ì§„ì…ì 
â”‚   â”œâ”€â”€ ğŸ“„package.json
â”‚   â”œâ”€â”€ ğŸ“„package-lock.json
â”‚   â”œâ”€â”€ ğŸ“„.gitignore                    # node_modules, env ë“± í¬í•¨ë˜ì§€ ì•Šê²Œ ì„¤ì •ìš”ë§
â”‚   â”œâ”€â”€ ğŸ“/config                       # í™˜ê²½ì„¤ì •
â”‚   â”‚    â””â”€â”€ ğŸ“„config.js            
â”‚   â”œâ”€â”€ ğŸ“/migrations 
â”‚   â”‚    â”œâ”€â”€ ğŸ“„20210819052749-create-users.js
â”‚   â”‚    â””â”€â”€ ğŸ“„20210819065842-add-column-in-usersTable.js          
â”‚   â”œâ”€â”€ ğŸ“/models                       # DB ëª¨ë¸ íŒŒì¼
â”‚   â”‚    â”œâ”€â”€ ğŸ“„index.js
â”‚   â”‚    â””â”€â”€ ğŸ“„users.js
â”‚   â”œâ”€â”€ ğŸ“/routes
â”‚        â””â”€â”€ ğŸ“„index.js                  # ë¶„ê¸° íŒŒì¼
â”‚   

```

<br>

# 1. ë¼ìš°í„° ë¶„ë¦¬

> ê³µì‹ ë ˆí¼ëŸ°ìŠ¤ ğŸ‘‰ [https://expressjs.com/en/4x/api.html#router](https://expressjs.com/ko/4x/api.html#router)

**/routes/index.js**

```js
const express = require('express');
const router = express.Router();

const { userController } = require('../controllers');


router.get('/', (req, res) => {
  res.send("Site access success");
});

router.post('/user/join', userController.join.post);

module.exports = router;
```

í”„ë¡œì íŠ¸ë¥¼ í•˜ë‹¤ë³´ë©´ ê¸°ëŠ¥ì´ ë§ì•„ì§€ê³ , ì½”ë“œì–‘ì´ ë„ˆë¬´ ë§ì´ ëŠ˜ì–´ë‚˜ ìœ ì§€ë³´ìˆ˜ê°€ í˜ë“¤ì§„ë‹¤.  ì´ê²ƒì„ ì‰½ê²Œ í•˜ê¸° ìœ„í•´ì„œëŠ” ì—°ê´€ì´ ìˆëŠ” ë¼ìš°í„°ë¼ë¦¬ ë¶„ë¦¬í•´ ê´€ë¦¬í•˜ê¸°ë„ í•œë‹¤. (Expressë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ã… ê¸°ë„ í•œë‹¤.)

### 1.1 express.Router()

```JS
const express = require('express');
const router = express.Router();
```

`const router = express.Router();`ëŠ” ìƒˆ ë¼ìš°í„° ê°ì²´ë¥¼ ë§Œë“œëŠ” ì½”ë“œì´ë‹¤.  ë§¤ê°œë³€ìˆ˜ë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” ì˜µì…˜ì´ ì´ 3ê°œê°€ ìˆë‹¤. 

`caseSensitive`ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë„£ìœ¼ë©´ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ì„ í•œë‹¤. ë¼ìš°í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ "/Foo"ì™€ "/foo"ë¥¼ í†µì¼í•˜ê²Œ ì¸ì‹í•œë‹¤. `mergeParams`ë¥¼ ë„£ìœ¼ë©´ ìƒìœ„ ë¼ì´í„°ì˜ `req.params`ê°’ì„ ìœ ì§€í•œë‹¤.  ë§Œì•½ ìƒìœ„ì™€ í•˜ìœ„ì˜ ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì´ ì¶©ëŒí•˜ê²Œ ë˜ë©´ í•˜ìœ„ ê°’ì„ ìš°ì„ ì‹œí•œë‹¤.`strict`ëŠ” ë¼ì´íŒ…ì˜ ê¸°ì¤€ì´ ì—„ê²©í•´ì§„ë‹¤. ì—„ê²©ì´ë¼ í•¨ì€, ë¼ìš°í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ "/foo"ì™€ "/foo/"ë¥¼ ë™ì¼í•˜ê²Œ ì¸ì‹í•˜ëŠ”ë°, ì´ëŸ° ë¶€ë¶„ì„ ë§í•œë‹¤. 

ì—¬í•˜íŠ¼ `router`ë¼ëŠ” ë¼ì´í„° ê°ì²´ë¥¼ ë§Œë“¤ì–´ë†¨ìœ¼ë‹ˆ, ì´ì œ `router`ë¡œ ë¼ìš°í„°ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```js
module.exports = router;
```

ê·¸ë¦¬ê³  ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ ë¼ìš°í„°ë¥¼ ë§ˆì§€ë§‰ ì¤„ì— ìœ„ ì½”ë“œë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ëª¨ë“ˆë¡œ ë§Œë“ ë‹¤.

### 1.2 app.METHOD(ê²½ë¡œ, ì½œë°± [, ì½œë°± ...])

```js
router.get('/', (req, res) => {
  res.send("Site access success");
});

router.post('/user/join', userController.join.post);
```

app.METHODì—ëŠ” í•´ë‹¹í•˜ëŠ” GET, PUT, POST, DELECT ë“±ì€ HTTP ìš”ì²­ ë©”ì†Œë“œì´ë‹¤. ì´ ë©”ì†Œë“œëŠ” ëª¨ë‘ ì†Œë¬¸ìë¡œ ë˜ì–´ìˆë‹¤. ì§§ê²Œ ì„¤ëª…í•˜ë©´ GETì€ ê³ ê°ì´ ìš”ì²­í•œ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì‘ë‹µí•˜ëŠ” ê²ƒì´ê³  PUTì€ ìš”ì²­ëœ ë°ì´í„°ë¥¼ DBì—ì„œ ìˆ˜ì •í•˜ëŠ” ë©”ì†Œë“œì´ë‹¤. POSTëŠ” ìš”ì²­ëœ ë°ì´í„°ë¥¼ DBì— ìƒˆë¡œ ìƒì„±í•œë‹¤.  DELETE ëŠ” ë°ì´í„°ë¥¼ ì‚­ì œí•œë‹¤. ìœ„ ì½”ë“œì—ì„  joinì´ ê³ ê°ì—ê²Œ ë°›ì€ íšŒì›ê°€ì… ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì§‘ì–´ ë„£ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì—`post`ìš”ì²­ë§Œì„ í–ˆë‹¤. 

ë¬¼ë¡  ì‹¤ì œë¡œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤ê³  í•´ì„œ ë¬´ì¡°ê±´ ì´ë£¨ì–´ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤. ìš”ì²­ì„ ê²€ì¦ í›„ ìœ íš¨í•  ë•Œë§Œ ì‹¤í–‰ëœë‹¤. 

### 1.3 app.use();

**/index.js**

```js
const express = require('express');

require("./models");
const Route = require("./routes/index");


const app = express();
const port = 3000;


app.use(express.json());
app.listen(port, () => {
  console.log(`http://localhost:${port} port success`);
});

app.use(Route);


module.exports = app; 
```

ì´ë ‡ê²Œ ì‘ì„±ëœ ë¼ìš°í„°ëŠ” ë¯¸ë“¤ì›¨ì–´ì²˜ëŸ¼ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— `app.use()`ë‚˜ ë˜ë‹¤ë¥¸ ë¼ìš°í„°ì˜ `use()` ë©”ì†Œë“œì— í•´í•œ ì¸ìˆ˜ë¡œ ì‚¬ìš©í•œë‹¤.

```js
...
const Route = require("./routes/index");
...
app.use(Route);
```

ê¸°ë³¸ ê²½ë¡œì— ìˆëŠ” index.jsë¥¼ ë³´ë©´ ìœ„ ë‘ ì¤„ì´ ì¶”ê°€ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.  

```js
const Route = require("./routes/index");
```

ìœ„ ì½”ë“œëŠ” ëª¨ë“ˆí™”ëœ ë¼ìš°í„° ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë¶ˆëŸ¬ì˜¨ ê²ƒì´ê³ ,

```js
app.use(Route);
```

ìœ„ ì½”ë“œëŠ” ë¶ˆëŸ¬ì˜¨ ë¼ìš°í„° ê°ì²´ë¥¼ ì‚¬ìš©ìì˜ ìš”ì²­ì— ë§ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì¡´ì¬í•˜ëŠ” ì½”ë“œì´ë‹¤.

<br>

***

# 2. Sequelize

> ê³µì‹ë ˆí¼ëŸ°ìŠ¤ğŸ‘‰ [https://sequelize.org/master/manual/migrations.html#the-cli](https://sequelize.org/master/manual/migrations.html#the-cli)


```
npm i sequelize
```

## 2.1 Sequelize-cli

### 2.1.1 ORM(Object-Relational-Management)

Sequelizeë¥¼ ê³µë¶€í•˜ê¸° ì „ì— ë¨¼ì € ì•Œì•„ì•¼ í•  ê²ƒì€ ORMì´ë¼ëŠ” ê°œë…ì´ë‹¤. ORMì€ ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ë§¤í•‘í•´, DBì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤.  ORMì´ ì—†ì—ˆë‹¤ë©´ ì¿¼ë¦¬ ì‘ì„±ì„ í†µí•´ì„œ í…Œì´ë¸” ìƒì„±, ì¡°íšŒ, ì—…ë°ì´íŠ¸, ì™¸ë˜í‚¤ì„¤ì •ì„ í–ˆì–´ì•¼ í–ˆë‹¤. 

ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ê¸°ëŠ¥ì´ ë–¨ì–´ì§€ì§€ë§Œ, ì¿¼ë¦¬ë¥¼ ì‹ ê²½ì“°ì§€ ì•Šì•„ë„ ë˜ë©°, ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‰½ê²Œí•   ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

### 2.1.2 Sequelize-Cli

nodejsì—ëŠ” ë‹¤ì–‘í•œ ORMì´ ì¡´ì¬í•˜ëŠ”ë°, Sequelize ê°€ ê·¸ ì¤‘ í•˜ë‚˜ì´ë‹¤.  ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ì‚¬í•­ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” `npm i sequelize`ë¥¼ í•˜ì—¬ Sequelizeë¥¼ ì„¤ì¹˜ í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ì•ˆëœë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ì´ë¼ëŠ” ê²ƒì„ ì‚¬ìš©í•´ì•¼í•œë‹¤. (ë§ˆì´ê·¸ë ˆì´ì…˜ì´ë€, ë‹¤ë¥¸ ìš´ì˜í™˜ê²½ìœ¼ë¡œ ì˜®ê²¨ê°€ëŠ” ê³¼ì •ì„ ë§í•˜ëŠ”ë°, ë°ì´í„°ë¥¼ í•œ ìœ„ì¹˜ì—ì„œ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ, ë˜ëŠ” í•œ í˜•ì‹ì—ì„œ ë‹¤ë¥¸ í˜•ì‹ìœ¼ë¡œ ì´ë™í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ë§í•œë‹¤.)

Sequelize ì—ì„œ ì´ëŸ¬í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” `Sequelize-cil`ê°€ í•„ìš”í•˜ë‹¤. ì´ëŠ” The Sequelize command line interfaceì˜ ì¤„ì„ë§ë¡œ, ëª…ë ¹ì–´ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ í•  ìˆ˜ ìˆëŠ” íˆ´ì´ë‹¤. ê¸°ëŠ¥ìœ¼ë¡œëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜, ì‹œë“œ, ëª¨ë¸ì´ ìˆë‹¤. 

**â–¶ CLI ì„¤ì¹˜**

```js
npm install --save-dev sequelize-cli
```

**â–¶ ë¹ˆ í”„ë¡œì íŠ¸ ìƒì„±**

```js
npx sequelize-cli init
```

ìœ„ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì£¼ë©´ `cofing`, `moderls`, `migrations`, `seeders` í´ë”ê°€ ìƒì„±ëœë‹¤. 

## 2.2 cofing

cofing íŒŒì¼ì€ CLIê°€ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°í•˜ê¸° ìœ„í•´ ì¡´ì¬í•œë‹¤. `dotenv`ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œ, `.env`ì—ì„œ ëŒê³ ì˜¬ ë‚´ìš©ì´ ìˆì–´ì„œ jsíŒŒì¼ë¡œ ë°”ê¿¨ì§€ë§Œ, ì›ë˜ëŒ€ë¡œë¼ë©´ `josn` íŒŒì¼ì´ ë§ë‹¤.

**/config/config.js**

```js
require("dotenv").config();

module.exports= {
  "development": {
    "username": process.env.DATABASE_USERNAME,
    "password": process.env.DATABASE_PASSWORD,
    "database": process.env.DATABASE_NAME,
    "host": process.env.DATABASE_HOST,
    "dialect": "mysql"
  },
  "test": {
    "username": process.env.DATABASE_USERNAME,
    "password": process.env.DATABASE_PASSWORD,
    "database": process.env.DATABASE_NAME,
    "host": process.env.DATABASE_HOST,
    "dialect": "mysql"
  },
  "production": {
    "username": process.env.DATABASE_USERNAME,
    "password": process.env.DATABASE_PASSWORD,
    "database": process.env.DATABASE_NAME,
    "host": process.env.DATABASE_HOST,
    "dialect": "mysql"
  }
}
```

`dotenv` ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„í¬íŠ¸ í•œ í›„, `config()`ë¥¼ í˜¸ì¶œí•´ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤. ê·¸ë¦¬ê³  `process.env`ë¡œë¶€í„° `.env`ì— ìˆëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼ ì½ê³  ì¶œë ¥í•œë‹¤. 

## 2.3 models,migrations íŒŒì¼ ë§Œë“¤ê¸°

```js
npx sequelize-cli model:generate --name User --attributes nickname:string,email:string,password:string
```

moderlsíŒŒì¼ê³¼ migrations íŒŒì¼ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ìœ„ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```
npx sequelize-cli db:migrate
```

ì‘ì„±í•œ ëª¨ë¸ì€ ìš°ì™€ ê°™ì€ ëª…ë ¹ì–´ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ í•  ìˆ˜ ìˆë‹¤. ë°”ë¡œ ì§ì „ì— í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì·¨ì†ŒëŠ” `npx sequelize-cli db:migrate:undo`ë¡œ í•  ìˆ˜ ìˆë‹¤. ëª¨ë“  ë§ˆì´ê·¸ë ˆì´ì…˜ ì·¨ì†ŒëŠ” `npx sequelize-cli db:migrate:undo:all`ë¥¼ í†µí•´ í•  ìˆ˜ ìˆë‹¤.

```
| Field     | Type         | Null |   Key   | Default | Extra          |
| --------- | ------------ | ---- | ------- | ------- | -------------- |
| id        | int          | NO   | PRI, FK | NULL    | auto_increment |
| nickname  | varchar(255) | NO   |         | NULL    |                |
| email     | varchar(255) | NO   |         | NULL    |                |
| password  | varchar(255) | NO   |         | NULL    |                |
| createdAt | datetime     | NO   |         | NULL    |                |
| updatedAt | datetime     | NO   |         | NULL    |                |
```

ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë§ˆì¹˜ê³  ë‚˜ë©´ ìœ„ì™€ ê°™ì€ í…Œì´ë¸”ì´ ì™„ì„±ëì„ ê²ƒì´ë‹¤.

## 2.4 ì¹¼ëŸ¼ì¶”ê°€

join APIë¥¼ ì‘ì„±í•  ë•Œ, ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¨ë°©í–¥ ì•”í˜¸í™”í•˜ì—¬ í…Œì´ë¸”ì— ì €ì¥í•˜ëŠ” ì‘ì—…ì„ í•´ì•¼í•´ì„œ ìŠ¤ìº˜ë ˆí†¤ì„ ì‚¬ìš©í–ˆë‹¤.****

```
npx sequelize migration:create --name add-column-in-usersTable
```

ìƒì„±ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì—ëŠ” ì•„ë˜ì²˜ëŸ¼ ì ì–´ì£¼ë©´ ëœë‹¤. 

**/migrations/20210819065842-add-column-in-usersTable.js** 

```js
'use strict';

module.exports = {
  up: async (queryInterface, Sequelize) => {
    queryInterface .addColumn( 'Users', 'salt', Sequelize.STRING )
  },

  down: async (queryInterface, Sequelize) => {
    await queryInterface.removeColumn('Users', 'salt');
  }
};
```

ë¬¸ì œëŠ” ìœ„ ì‘ì—…ê¹Œì§€ë§Œ í•˜ë©´, ìš°ë¦¬ì˜ DBì—ëŠ” ë°˜ì˜ì´ë˜ì§€ë§Œ, Javascriptë¡œ ì ‘ê·¼í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

**/models/users.js**

```js
'use strict';
const {
  Model
} = require('sequelize');
module.exports = (sequelize, DataTypes) => {
  class Users extends Model {
    /**
     * Helper method for defining associations.
     * This method is not a part of Sequelize lifecycle.
     * The `models/index` file will call this method automatically.
     */
    static associate(models) {
      // define association here
    }
  };
  Users.init({
    nickname: DataTypes.STRING,
    email: DataTypes.STRING,
    password: DataTypes.STRING,
    salt: DataTypes.STRING // ì¶”ê°€
  }, {
    sequelize,
    modelName: 'Users',
  });
  return Users;
};
```

ìœ„ ì½”ë“œì²˜ëŸ¼ ì¶”ê°€í•˜ê³ ì í•˜ëŠ” ì¹¼ëŸ¼ì„ ëª¨ë¸ íŒŒì¼ì— ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤.
