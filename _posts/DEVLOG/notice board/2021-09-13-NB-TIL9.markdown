---
layout: post
title: '[ê²Œì‹œíŒ ë§Œë“¤ê¸°] TIL 9. Withdrawal, SearchBoards '
date: 2021-09-13 21:18:44 +0900
subtitle: 'Wiki'
categories: DEVLOG
tags: Notice_Board
comments: true
toc: true
---

> 1. Withdrawal(íƒˆí‡´) : `destroy()`
>
> 2. SearchBoards : 
>
>    2.1. Url params
>    
>    2.2. operators(`Op.like`)
>    
>    2.3. operators(`Op.or`)
>

<br>

ğŸ˜€ [Notice Board ë ˆíŒŒì§€í† ë¦¬](https://github.com/riverpark94/Notice_Board)ğŸ˜€ <br>Stack : Javascript, express, nodejs, sequelize
{: .notice--warning}

<br>

â˜… : ì´ë²ˆ ê³¼ì •ì„ í†µí•´ì„œ ìƒˆë¡œ ë§Œë“¤ì–´ì§„ íŒŒì¼

â˜† : ì´ë²ˆ ê³¼ì •ì„ í†µí•´ì„œ ìˆ˜ì •ëœ íŒŒì¼

```
/
â”œâ”€â”€ ğŸ“/server
â”‚   â”œâ”€â”€ ğŸ“„README.md                     # Notice_Board README./
â”œâ”€â”€ ğŸ“/server
â”‚   â”œâ”€â”€ ğŸ“„README.md                     # Notice_Board README.md íŒŒì¼
â”‚   â”œâ”€â”€ ğŸ“„index.js                      # node.jsë¡œ ì‘ì„±ëœ ì›¹ ì„œë²„ ì§„ì…ì 
â”‚   â”œâ”€â”€ ğŸ“„package.json
â”‚   â”œâ”€â”€ ğŸ“„package-lock.json
â”‚   â”œâ”€â”€ ğŸ“„.gitignore                    # node_modules, env ë“± í¬í•¨ë˜ì§€ ì•Šê²Œ ì„¤ì •ìš”ë§
â”‚   â”œâ”€â”€ ğŸ“/config                       # í™˜ê²½ë³€ìˆ˜
â”‚   â”‚    â”œâ”€â”€ ğŸ“„config.js        
â”‚   â”‚    â””â”€â”€ ğŸ“„jwt.js                   # jwt ê´€ë ¨ í™˜ê²½ë³€ìˆ˜
â”‚   â”œâ”€â”€ ğŸ“/controllers                  # ê¸°ëŠ¥ API
â”‚   â”‚    â”œâ”€â”€ ğŸ“„â˜† index.js        
â”‚   â”‚    â”œâ”€â”€ ğŸ“User                     # ìœ ì €ê´€ë ¨ API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„â˜† index.js 
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„join.js             # join API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„login.js            # login API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„logout.js           # logout API
â”‚   â”‚    â”‚    â””â”€â”€ ğŸ“„â˜… withdrawal.js    # withdrawal API
â”‚   â”‚    â”œâ”€â”€ ğŸ“MyPage                   # ë§ˆì´í˜ì´ì§€ API
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„index.js 
â”‚   â”‚    â”‚    â”œâ”€â”€ ğŸ“„myPage.js            # myPage API
â”‚   â”‚    â”‚    â””â”€â”€ ğŸ“„editUserInfo.js      # editUserInfo API
â”‚   â”‚    â””â”€â”€ ğŸ“Boards                   # ê²Œì‹œíŒ API
â”‚   â”‚         â”œâ”€â”€ ğŸ“„â˜† index.js 
â”‚   â”‚         â”œâ”€â”€ ğŸ“„writeBoard.js        # writeBoard API
â”‚   â”‚         â””â”€â”€ ğŸ“„â˜… searchBords.js    # searchBords API
â”‚   â”œâ”€â”€ ğŸ“/middlewares
â”‚   â”‚    â”œâ”€â”€ ğŸ“„CheckEmailForm.js        # email ì–‘ì‹ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” middleware
â”‚   â”‚    â”œâ”€â”€ ğŸ“„CheckPassword.js         # password ì¡°ê±´ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” middleware      
â”‚   â”‚    â””â”€â”€ ğŸ“„checkToken.js            # JWT ê²€ì¦ middleware
â”‚   â”œâ”€â”€ ğŸ“/migrations 
â”‚   â”‚    â”œâ”€â”€ ğŸ“„20210819052749-create-users.js
â”‚   â”‚    â”œâ”€â”€ ğŸ“„20210819065842-add-column-in-usersTable.js   
â”‚   â”‚    â”œâ”€â”€ ğŸ“„20210910065541-create-boards.js
â”‚   â”‚    â””â”€â”€ ğŸ“„20210910070528-fk-Boards.js         
â”‚   â”œâ”€â”€ ğŸ“/models                       # DB ëª¨ë¸ íŒŒì¼
â”‚   â”‚    â”œâ”€â”€ ğŸ“„index.js
â”‚   â”‚    â”œâ”€â”€ ğŸ“„users.js
â”‚   â”‚    â””â”€â”€ ğŸ“„boards.js
â”‚   â”œâ”€â”€ ğŸ“/routes
â”‚        â””â”€â”€ ğŸ“„â˜† index.js               # ë¶„ê¸° íŒŒì¼
â”‚   
```

<br>

**controllers/Users/withdrawal.js**

```js
const { Users } = require('../../models');

module.exports = {
  delete : async (req, res) =>{
    const { nickname } = req.body;
    const email = req.user;

    Users.destroy({
      where : {
        email
      }
    }).then(data =>{
      res
        .status(205)
        .clearCookie("sid")
        .send("Withdrawal success");
    })
  }
}
```

**controllers/Boards/searchBords.js**

```js
const { Boards } = require('../../models');
const { Op } = require("sequelize");

module.exports = {
  get : async (req, res) =>{
    const { search } = req.params;

    Boards.findAll({
      where : {
        [Op.or] : [
          {
            title : {
              [Op.like]: "%" + search + "%"
            }
          }, {
            content : {
              [Op.like]: "%" + search + "%"
            }
          }
        ]          
      },
      order: [['createdAt', 'DESC']]
    }).then(data => {
        res.status(200).send(data)
    })
  }
}
```

**/routes/index.js**

```js
const express = require('express');
const router = express.Router();

const checkToken = require('../middlewares/checkToken');
const { userController, 
        myPageController, 
        BoardController } = require('../controllers');

router.get('/', (req, res) => {
  res.send("Site access success");
});

router.post('/user/join', userController.join.post);
router.post('/user/login', userController.login.post);
router.get('/board/searchBords/:search', BoardController.searchBords.get);

router.use(checkToken);

router.post('/user/logout', userController.logout.post);
router.delete('/user/withdrawal', userController.withdrawal.delete);

router.get('/user/myPage', myPageController.myPage.get);
router.put('/user/myPage', myPageController.editUserInfo.put);

router.post('/board/write', BoardController.writeBoard.post);

module.exports = router;
```



<br>

1. Withdrawal(íƒˆí‡´) : `destroy()`
2. SearchBoards : ìœ ì‚¬ê²€ìƒ‰

# 1. Withdrawal

**controllers/Users/withdrawal.js**

```js
const { Users } = require('../../models');

module.exports = {
  delete : async (req, res) =>{
    const { nickname } = req.body;
    const email = req.user;

    Users.destroy({
      where : {
        email
      }
    }).then(data =>{
      res
        .status(205)
        .clearCookie("sid")
        .send("Withdrawal success");
    })
  }
}
```

sequelizeëŠ” ë°ì´í„°ë¥¼ ì‚­ì œí•˜ëŠ” ì¿¼ë¦¬ë¬¸ì„ ì‘ì„±í•  ë•Œ, `destroy()`ë¥¼ ì‚¬ìš©í•˜ê³  `where` ì˜µì…˜ì„ ì‚¬ìš©í•œë‹¤. 

JWT í† í° ê²€ì¦ì„ í†µí•´ emailì„ `req.user`ì— ë„£ì–´ë†¨ìœ¼ë‹ˆ, ê·¸ê²ƒìœ¼ë¡œ Users í…Œì´ë¸”ì„ ê²€ìƒ‰í•˜ê³  í•´ë‹¹ ë°ì´í„°ë¥¼ ì‚­ì œí•œë‹¤. í•´ë‹¹ ê¸°ëŠ¥ì€ JWT í† í° ê²€ì¦ì„ ê±°ì³¤ìœ¼ë‹ˆ ë¡œê·¸ì•„ì›ƒ ë•Œì²˜ëŸ¼ í† í°ì´ ë“¤ì–´ìˆëŠ” cookie ë˜í•œ ì‚­ì œí•œë‹¤. 

<br>

# 2. SearchBoards : Operators

**controllers/Boards/searchBords.js**

```js
const { Boards } = require('../../models');
const { Op } = require("sequelize");

module.exports = {
  get : async (req, res) =>{
    const { search } = req.body;

    Boards.findAll({
      where : {
        title : {
                [Op.like]: "%" + search + "%"
            }
      }
    }).then(data => {
        res.status(200).send(data)
    })
  }
```

ê° í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ëŠ” ì—°ì‚°ìë¼ëŠ” ê²Œ ì¡´ì¬í•˜ ë“¯ì´ DBì—ë„ ë§ˆì°¬ê°€ì§€ ì´ë‹¤.  

```js
const Op = Sequelize.Op
```

## 2.1 ë¼ìš°í„°(Url params)

**/routes/index.js**

```js
const express = require('express');
const router = express.Router();

const checkToken = require('../middlewares/checkToken');
const { userController, 
        myPageController, 
        BoardController } = require('../controllers');

.
.
.

router.get('/board/searchBords/:search', BoardController.searchBords.get);

.
.
.

module.exports = router;
```

URL params ë€, í´ë¦­ìœ¼ë¡œ ì •ë³´ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ì‹ì´ë‹¤. ì˜ˆë¥¼ë“¤ë©´ íŠ¹ì • ê²Œì‹œê¸€ì„ ë³´ê±°ë‚˜, ê²€ìƒ‰ì²˜ëŸ¼ ì‚¬ìš©ìì— ì˜í•´ URL ì •ë³´ê°€ ê²°ì •ë˜ëŠ” ê²ƒë“¤ì´ ìˆë‹¤. ì´ ì •ë³´ë“¤ì€ ë§¤ìš° ìœ ë™ì ì´ë¼ì„œ ë¼ìš°í„°ë¥¼ ë”± ì •í•  ìˆ˜ ì—†ëŠ”ë°, ê·¸ëŸ´ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ `:(í‚¤ì›Œë“œ)`ì´ë‹¤. ì´ë•Œ `:`(ì½œë¡ ) ë’¤ì—ìˆëŠ” í‚¤ì›Œë“œëŠ” `req.params`ë¥¼ í†µí•´ ì–»ì„ ìˆ˜ ìˆë‹¤.

## 2.2 operators(`Op.like`)

**controllers/Boards/searchBords.js**

```js
const { Boards } = require('../../models');
const { Op } = require("sequelize");

module.exports = {
  get : async (req, res) =>{
    const { search } = req.params;

    Boards.findAll({
      where : {
        title : {
                [Op.like]: "%" + search + "%"
            }
      }
    }).then(data => {
        res.status(200).send(data)
    })
  }
```

sequelizeì—ì„œëŠ” ì´ë¥¼ operatorsë¼ê³  í•˜ëŠ”ë°,  ë”°ë¡œ ì„¤ì¹˜ ì—†ì´ ìœ„ì²˜ëŸ¼ Op ê°ì²´ê°€ ì •ì˜ë˜ì–´ì•¼ í•œë‹¤.

ë³´í†µ ê²Œì‹œë¬¼ì„ ê²€ìƒ‰í•  ë•ŒëŠ” í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•´ í‚¤ì›Œë“œê°€ ì“°ì¸ ëª¨ë“  ê¸€ì„ ì¶œë ¥í•œë‹¤. ë•Œë¬¸ì—, ì™„ì „íˆ ë˜‘ê°™ì§€ ì•Šì€ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ë„ ê²€ìƒ‰ì–´ê°€ ê¸€ì— í¬í•¨ë˜ì–´ìˆìœ¼ë©´ ê²€ìƒ‰ë˜ëŠ” ìœ ì‚¬ê²€ìƒ‰ì„ ì‚¬ìš©í–ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ DBëŠ” ìœ ì‚¬ê²€ìƒ‰ìœ¼ë¡œ `%` ê¸°í˜¸ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•œë‹¤. 

`%River`ë¥¼ ì‘ì„±í•˜ë©´ Riverë¡œ ëë‚˜ëŠ” ê²ƒì„ ê²€ìƒ‰í•˜ê³ , `River%`ëŠ” ê·¸ ë°˜ëŒ€ì¸ Riverë¡œ ì‹œì‘í•˜ëŠ” ë¬¸ìì—´ì„, `%River%`ëŠ” Riverê°€í¬í•¨ëœ ë¬¸ìì—´ì„ ê²€ìƒ‰í•´ì„œ ì¶œë ¥í•œë‹¤.

## 2.3 operators(`Op.or`)

```js
const { Boards } = require('../../models');
const { Op } = require("sequelize");

module.exports = {
  get : async (req, res) =>{
    const { search } = req.params;

    Boards.findAll({
      where : {
        [Op.or] : [
          {
            title : {
              [Op.like]: "%" + search + "%"
            }
          }, {
            content : {
              [Op.like]: "%" + search + "%"
            }
          }
        ]          
      },
      order: [['createdAt', 'DESC']]
    }).then(data => {
        res.status(200).send(data)
    })
  }
}
```

ë³´í†µ í¬í„¸ì‚¬ì´íŠ¸ì— ì–´ë–¤ í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•  ë•Œ, ê·¸ í‚¤ì›Œë“œê°€ ì œëª©ì— ìˆëŠ” ê²ƒ ë¿ ì•„ë‹ˆë¼, ë‚´ìš©ì— í¬í•¨ëœ ê²ƒë„ ì¶œë ¥í•˜ê³¤ í•œë‹¤. ê·¸ë˜ì„œ operators ì¤‘ í•˜ë‚˜ì¸ orë¥¼ í†µí•´ `title` í…Œì´ë¸”ë¿ë§Œ ì•„ë‹ˆë¼ `content` í…Œì´ë¸”ê¹Œì§€ ê²€ìƒ‰í•˜ë„ë¡ í–ˆë‹¤.

<br>
