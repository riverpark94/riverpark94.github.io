---
layout: post
title: '[Notice Board] TIL 4. join API'
date: 2021-08-31 21:18:44 +0900
subtitle: 'Wiki'
categories: DEVLOG
tags: Notice_Board
comments: true
toc: true
---

> 1. ë¼ìš°í„° ë¶„ë¦¬
> 2. Sequelize
> 3. Join API
>    3.1. controllers
>    3.2. middlewares

<br>

ğŸ˜€ [Notice Board ë ˆíŒŒì§€í† ë¦¬](https://github.com/riverpark94/Notice_Board)ğŸ˜€ 
{: .notice--warning}

<br>

```
/
â”œâ”€â”€ ğŸ“/server
â”‚   â”œâ”€â”€ ğŸ“„README.md                     # Notice_Board README.md íŒŒì¼
â”‚   â”œâ”€â”€ ğŸ“„index.js                      # node.jsë¡œ ì‘ì„±ëœ ì›¹ ì„œë²„ ì§„ì…ì 
â”‚   â”œâ”€â”€ ğŸ“„package.json
â”‚   â”œâ”€â”€ ğŸ“„package-lock.json
â”‚   â”œâ”€â”€ ğŸ“„.gitignore                    # node_modules, env ë“± í¬í•¨ë˜ì§€ ì•Šê²Œ ì„¤ì •ìš”ë§
â”‚   â”œâ”€â”€ ğŸ“/config                       # í™˜ê²½ì„¤ì •
â”‚   â”‚    â””â”€â”€ ğŸ“„config.js         
â”‚   â”œâ”€â”€ ğŸ“/controllers                  # ê¸°ëŠ¥ API
â”‚   â”‚    â”œâ”€â”€ ğŸ“„index.js        
â”‚   â”‚    â”œâ”€â”€ ğŸ“User                     #ìœ ì €ê´€ë ¨ API
â”‚   â”‚         â”œâ”€â”€ ğŸ“„index.js 
â”‚   â”‚         â””â”€â”€ ğŸ“„join.js             # join API
â”‚   â”œâ”€â”€ ğŸ“/middlewares
â”‚   â”‚    â”œâ”€â”€ ğŸ“„CheckEmailForm.js        # email ì–‘ì‹ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” middleware     
â”‚   â”‚    â””â”€â”€ ğŸ“„CheckPassword.js         # password ì¡°ê±´ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” middleware      
â”‚   â”œâ”€â”€ ğŸ“/migrations 
â”‚   â”‚    â”œâ”€â”€ ğŸ“„20210819052749-create-users.js
â”‚   â”‚    â””â”€â”€ ğŸ“„20210819065842-add-column-in-usersTable.js          
â”‚   â”œâ”€â”€ ğŸ“/models                       # DB ëª¨ë¸ íŒŒì¼
â”‚   â”‚    â”œâ”€â”€ ğŸ“„index.js
â”‚   â”‚    â””â”€â”€ ğŸ“„users.js
â”‚   â”œâ”€â”€ ğŸ“/routes
â”‚        â””â”€â”€ ğŸ“„index.js                  # ë¶„ê¸° íŒŒì¼
â”‚   

```

<br>

# 1. controllers

```js
const { Users } = require('../../models');
const checkPassword = require("../../middlewares/CheckPassword");
const checkEmailForm = require("../../middlewares/CheckEmailForm");
const crypto = require('crypto');

require('dotenv').config();

module.exports = {
  post : async (req, res) =>{
    const { email, nickname, password } = req.body;

    if( !email || !nickname  || !password) {
      res.status(400).send("not enough user information.");
    }
    else if (nickname.length > 10) {
      res.status(403).send("make nickname less than 10 characters.");
    }
    else if (!checkPassword(password)) {
      res.status(403).send("Special Characters or Numbers or English were not included in password.");
    }
    else if (!checkEmailForm(email)) {
      res.status(403).send("Keep e-mail form.");
    }
    else{
      const createSalt = () => 
        new Promise ((resolve, reject) => {
          crypto.randomBytes(64, (err, buf) => {
            if (err) reject(err);
            resolve(buf.toString('base64'));
          })
        })

      const createHashedPassword = (pass) => 
        new Promise(async (resolve, reject) =>{
          const salt = await createSalt();
          crypto.pbkdf2(pass, salt, 1009, 64, 'sha512', (err, key) => {
            if (err) reject(err);
            resolve({ hashpaw: key.toString('base64'), salt })
          });
        });

      const { hashpaw, salt } = await createHashedPassword(password);

      await Users.findOrCreate({
        where : {
          email
        },
        defaults: {
          nickname, 
          password : hashpaw,
          salt:salt
        }
      }).then(([data, created]) => {
        if (!created) {
          res.status(402).send("existed email");
        }
        else {
          res.status(201).json(data);
        }
      })
    }
  }
}
```

 ## 1.1 ì‚¬ìš©ìì—ê²Œ ë°›ì€ ì •ë³´

```js
const { email, nickname, password } = req.body;
```

íšŒì›ê°€ì…ì´ë€, ê³ ê°ì—ê²Œ ì¼ì • ì •ë³´ë¥¼ ì–»ê³  ê·¸ê²ƒì„ ì €ì¥í•˜ê³  ìˆë‹¤ê°€ ê³ ê°ì´ ë¡œê·¸ì¸ì„ ìš”ì²­í•˜ë©´ íšŒì›ê°€ì… ì‹œ ì €ì¥í•œ ì •ë³´ì™€ ë¹„êµí•˜ì—¬ ìŠ¹ì¸ í˜¹ì€ ë°˜ë ¤ ì²˜ë¦¬ë¥¼ í•œë‹¤. í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œëŠ” íšŒì›ê°€ì… ì‹œ `email`, `nickname`, `password`ë§Œ ë°›ëŠ”ë‹¤. ê·¸ë¦¬ê³  ì´ê²ƒì€ `req.body`ì—ì„œ ì–»ì„ ìˆ˜ ìˆë‹¤. Express v4.16.0 ì´ì „ì—ëŠ” bodyparserë¼ëŠ” node.jsì˜ ëª¨ë“ˆì„ ì‚¬ìš©í–ˆì§€ë§Œ, ì´ì œëŠ” Express ë‚´ë¶€ì— ë¹„íŠ¸ì¸ ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ëª¨ë“ˆ ì‚¬ìš© ì—†ì´  `req.body`ì˜ ê°’ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.

 ## 1.2 ì—ëŸ¬ì²˜ë¦¬

- ì´ë¯¸ ì´ë©”ì¼ì´ ì¡´ì¬í•  ê²½ìš° `403` (ì§€ê¸ˆ ë¶ˆê°€ => DBë¥¼ í™•ì¸í•´ì•¼í•˜ê¸° ë•Œë¬¸)
- ì´ë©”ì¼, ë‹‰ë„¤ì„, ë¹„ë°€ë²ˆí˜¸ ì»¬ëŸ¼ì´ ë¹„ì—ˆì„ ê²½ìš° `400`
- ë‹‰ë„¤ì„ì´ 10ì ì´ˆê³¼ì¸ ê²½ìš° `403`
- ë¹„ë°€ë²ˆí˜¸ì— ì˜ë¬¸ê³¼ ìˆ«ìê°€ í¬í•¨ë˜ì§€ ì•Šì•˜ì„ ê²½ìš° `403`
- ì´ë©”ì¼í˜•ì‹ì—ì„œ ì–´ê¸‹ë‚¬ì„ ê²½ìš° `403`

```js
if( !email || !nickname  || !password) {
  res.status(400).send("not enough user information.");
}
else if (nickname.length > 10) {
  res.status(403).send("make nickname less than 10 characters.");
}
else if (!checkPassword(password)) {
  res.status(403).send("Special Characters or Numbers or English were not included in password.");
}
else if (!checkEmailForm(email)) {
  res.status(403).send("Keep e-mail form.");
}
```

## 1.3 ë¹„ë°€ë²ˆí˜¸ ë‹¨ë°©í–¥ ì•”í˜¸í™”

```js
const crypto = require('crypto');

const createSalt = () => 
  new Promise ((resolve, reject) => {
    crypto.randomBytes(64, (err, buf) => {
      if (err) reject(err);
      resolve(buf.toString('base64'));
    })
  })
const createHashedPassword = (pass) => 
  new Promise(async (resolve, reject) =>{
    const salt = await createSalt();
    crypto.pbkdf2(pass, salt, 1009, 64, 'sha512', (err, key) => {
      if (err) reject(err);
      resolve({ hashpaw: key.toString('base64'), salt })
    });
  });
const { hashpaw, salt } = await createHashedPassword(password);
```

ì•”í˜¸í™”ë€, ë¬¸ì¥ì„ ì•Œ ìˆ˜ ì—†ëŠ” ê·œì¹™ìœ¼ë¡œ ë§Œë“¤ì–´ í•´í‚¹ì„ ë‹¹í•´ë„ ê·¸ ë¬¸ì¥ì„ ì•Œ ìˆ˜ ì—†ê²Œ ë§Œë“œëŠ” ê²ƒì´ë‹¤. ë§Œì•½ ì›ë¬¸ì¥ìœ¼ë¡œ ì €ì¥í•˜ë©´ í•´í‚¹ì— ë§¤ìš° ì·¨ì•½í•˜ë‹¤. (ì´ê±¸ í˜ì´ìŠ¤ë¶ì—ì„œ í•´ì™”ë‹¤...[2019ë…„ ê¸°ì‚¬](https://www.boannews.com/media/view.asp?idx=78058&page=1&kind=1))ì´ ì•”í˜¸í™”ì—ëŠ” ë‘ ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤.  ë³µì›í•  ìˆ˜ ìˆëŠ” ì•”í˜¸í™”ì™€ ë³µì›í•  ìˆ˜ ì—†ëŠ” ì•”í˜¸í™”ë‹¤. ì´ í”„ë¡œì íŠ¸ì—ì„œ ì“¸ ë°©ë²• ë³µì›í•  ìˆ˜ ì—†ëŠ” ë‹¨ë°©í–¥ í•´ì‹œ ì•”í˜¸(One-Way Hash Function)ì´ë‹¤.

```
npm i crypto
```

bcryptë„ ìˆì§€ë§Œ, cryptoë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ” BcryptëŠ” Blowfish ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì—„ì²­ë‚œ ë¹„ìš©ì´ ë“ ë‹¤ëŠ” ê²ƒê³¼ crypto ëª¨ë“ˆì´ Node ê¸°ë³¸ ëª¨ë“ˆì— ìˆëŠ” ì´ìœ ê°€ ìˆë‹¤ê³  ìƒê°í•´ì„œ cryptoì„ ì‚¬ìš©í•´ ì•”í˜¸í™”í•˜ê³ ì í•œë‹¤. 

```js
crypto.createHash('sha512').update('1234').digest('base64');
crypto.createHash('sha512').update('1234').digest('base64');
```

`crypto`ëª¨ë“ˆì„ ë¶ˆëŸ¬ì™€ `createHash`ë¥¼ ì‚¬ìš©í•´ ë˜ì§€ë§Œ, ì´ ë°©ë²•ì€ ê°™ì€ ë¹„ë°€ë²ˆí˜¸ì— ëŒ€í•´ ê°™ì€ ì•”í˜¸ë¬¸ìœ¼ë¡œ ë°˜í™˜í•œë‹¤. ê·¸ ë•Œë¬¸ì— í•´ì»¤ë“¤ì´ ê²°ê³¼ë§Œì„ ë³´ê³  ì›ë˜ ì•”í˜¸ë¥¼ ìœ ì¶”í•  ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í•œë‹¤. ì´ê²ƒì„ ë ˆì¸ë³´ìš° í…Œì´ë¸”ì´ë¼ê³  í•œë‹¤. 

```js
const createSalt = () => 
  new Promise ((resolve, reject) => {
    crypto.randomBytes(64, (err, buf) => {
      if (err) reject(err);
      resolve(buf.toString('base64'));
    })
  })
```

ë ˆì¸ë³´ìš° í…Œì´ë¸”ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë§ì€ ë°©ë²•ì´ ìˆì§€ë§Œ, ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” saltë¼ëŠ” íŠ¹ì • ê°’ì„ ì´ìš©í•œë‹¤. ê·¸ë¦¬ê³  ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ saltê°’ì€  ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•´ì•¼í•œë‹¤. ë¡œê·¸ì¸ì„ ì‹œë„í•´í•  ë•Œ ê°™ì€ saltê°’ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ì•„ì•¼ ë¹„êµê°€ ê°€ëŠ¥í•˜ë‹¤. ([TIL3ì— ë³´ë©´ ì´ë¥¼ ìœ„í•´ì„œ ì¹¼ëŸ¼ì„ ì¶”ê¸°í–ˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.](https://riverpark94.github.io/devlog/2021/08/18/NB-TIL3/#24-%EC%B9%BC%EB%9F%BC%EC%B6%94%EA%B0%80) ) **`randomBytes`ë¥¼ í†µí•´ ë§¤ë²ˆ ë‹¤ë¥¸ 64ë°”ì´íŠ¸ê¸¸ì´ì˜ saltë¥¼ ìƒì„±**í•œë‹¤. bufëŠ” ë²„í¼ í˜•ì‹ìµ ë•Œë¬¸ì— `buf.toString('base64')`ë¥¼ í†µí•´ 64ë°”ì´íŠ¸ë¡œ ìƒì„±ëœ saltë¥¼ base64 ë¬¸ìì—´ saltë¡œ ë³€ê²½í•œë‹¤. ì´ë¯¸ ë§¤ë²ˆ ë‹¤ë¥¸ saltê°’ì„ ìƒì„±í•¨ì—ë„, base64 ë¬¸ìì—´ saltë¡œ í•œ ë²ˆ ë” ë³€ê²½í•´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. ì´í›„ì— í•´ì‹œ ë‹¨ë°©í–¥ ì•”í˜¸ë¥¼ ë§Œë“¤ ë•Œ keyê°€ ë²„í¼ í˜•íƒœë¡œ ë¦¬í„´í•´ì£¼ê¸° ë•Œë¬¸ì— base64 ë°©ì‹ìœ¼ë¡œ ë¬¸ìì—´ì„ ë§Œë“¤ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

```js
const createHashedPassword = (pass) => 
  new Promise(async (resolve, reject) =>{
    const salt = await createSalt();
    crypto.pbkdf2(pass, salt, 123450, 64, 'sha512', (err, key) => {
      if (err) reject(err);
      resolve({ hashpaw: key.toString('base64'), salt })
    });
  });
```

ê·¸ë‹¤ìŒì€ `pbkdf2`ë¥¼ í†µí•´ì„œ í•´ì‹œ ë‹¨ë°©í–¥ ì•”í˜¸ë¥¼ ë§Œë“¤ì–´ì£¼ë©´ ëœë‹¤. `pbkdf2`ì˜ ì¸ìëŠ” ì´ 5ê°œì´ë‹¤. ìˆœì„œëŒ€ë¡œ  **ë¹„ë°€ë²ˆí˜¸, salt, ë°˜ë³µ íšŸìˆ˜, ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´, í•´ì‹œ ì•Œê³ ë¦¬ì¦˜** ìˆœì´ë‹¤. 

- ë¹„ë°€ë²ˆí˜¸ :  íšŒì›ê°€ì…ì„ í•œ ê³ ê°ì—ê²Œ ì…ë ¥ë°›ëŠ”ë‹¤. 
- salt : ë§¤ë²ˆ ë‹¤ë¥¸ salt ê°’ì„ ë±‰ëŠ” `createSalt`ë¼ëŠ” í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ë§Œë“¤ì–´ì¤¬ë‹¤. (ë§¤ë²ˆ ë‹¤ë¥¸ base64 ë¬¸ìì—´ salt) 
- ë°˜ë³µíšŸìˆ˜ : 10ë§Œ ë²ˆ ì´ìƒìœ¼ë¡œ ì§€ì •í•´ì¤¬ëŠ”ë°, ì–´ì°¨í”¼ ì—°ì‚°ì€ ì»´í“¨í„°ê°€ í•˜ê¸° ë•Œë¬¸ì— 1ì´ˆë„ ì•ˆ ê±¸ë¦°ë‹¤ê³  í•œë‹¤. ì´ ìˆ«ìê°€ ë†’ì„ìˆ˜ë¡ ìŠˆí¼ì»´í“¨í„°ë¥¼ ì´ìš©í•´ì„œ ë ˆì¸ë³´ìš° í…Œì´ë¸”ì„ ë§Œë“¤ê¸° í˜ë“¤ì–´ì§„ë‹¤. ë”± ë–¨ì–´ì§„ ìˆ˜ë³´ë‹¤ëŠ” ìœ„ ë¶ˆê·œì¹™í•œ ìˆ«ìë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  í•œë‹¤.
- ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ : ì ë‹¹í•œ ê¸¸ì´ë¡œ í•´ì£¼ë©´ ëœë‹¤.
- í•´ì‹œì•Œê³ ë¦¬ì¦˜ : ë‹¨ë°©í–¥ì„± í•´ì‹œ ì•”ìˆ˜ì—ëŠ” ì¢…ë¥˜ê°€ ë§ë‹¤. SHA, MD, HAS, WHIRLPOOL ë“±ì´ ìˆë‹¤. ì´ì¤‘ì—ì„œ ìµœì†Œ ê¶Œì¥ìƒí–¥ì¸ SHA2ê³„ì—´ì˜ SHA25ë¥¼ ì‚¬ìš©í–ˆë‹¤.

ìœ„ í•¨ìˆ˜ê°€ ì˜ ì‘ë™í•˜ë©´ ê°ì²´í˜•íƒœì˜ ê°’ì„ ë±‰ì„ ê²ƒì´ë‹¤. ì•”í˜¸ë¬¸ìœ¼ë¡œ ë°”ë€ ë¹„ë°€ë²ˆí˜¸ëŠ” `hashpaw`ë¼ëŠ” í‚¤ì˜ valueë¡œ ë“¤ì–´ê°ˆ ê²ƒì´ê³ , saltê°’ ë˜í•œ, `salt`ë¼ëŠ” í‚¤ì˜ valueë¡œ ë“¤ì–´ê°€ ìˆì„ ê²ƒì´ë‹¤. 

```js
const { hashpaw, salt } = await createHashedPassword(password);
```

ë‹¨ë°©í–¥ í•´ì‰¬ ì•”í˜¸ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ì— ì‚¬ìš©ìì—ê²Œ ë°›ì€ í˜ìŠ¤ì›Œë“œë¥¼ ì…ë ¥ í›„, ê·¸ ê°’ì„ ê°ê° `hashpaw`ì™€ `salt`ë¼ëŠ” ë³€ìˆ˜ì— í• ë‹¹í•˜ë©´ ì´ë¡œì¨ Users DBì— ë„£ì–´ì•¼ í•  ì •ë³´ëŠ” ëª¨ë‘ ì–»ê²Œ ëœë‹¤.

## 1.4 User DBì— ì •ë³´ ë„£ê¸°

```js
await Users.findOrCreate({
  where : {
    email
  },
  defaults: {
    nickname, 
    password : hashpaw,
    salt:salt
  }
}).then(([data, created]) => {
  if (!created) {
    res.status(402).send("existed email");
  }
  else {
    res.status(201).json(data);
  }
})
```

ì´ì œ DBì— ì •ë³´ë¥¼ ë„£ëŠ” ì¼ë§Œì´ ë‚¨ì•˜ë‹¤. ë¬¼ë¡  ì´ë¿ë§Œ ì•„ë‹ˆë¼, DBì— ì ‘ê·¼í•´ì•¼ë§Œ í•  ìˆ˜ ìˆì—ˆë˜ ì´ë©”ì¼ ì¡´ì¬ ì—¬ë¶€ ë˜í•œ ì—¬ê¸°ì„œ í•´ì•¼í•œë‹¤. Sequelizeì—ëŠ” ì—¬ëŸ¬ ê°œì˜ Finder í•¨ìˆ˜ê°€ ì¡´ì¬í•œë‹¤. ì´ finder í•¨ìˆ˜ëŠ” DBë¡œë¶€í„° ë°ì´í„° ë² ì´ìŠ¤ ì¿¼ë¦¬ë¥¼ ì‚¬ìš”í•˜ëŠ” ë°ì— ì‚¬ìš©ëœë‹¤. 

```js
await Users.findOrCreate({
  where : {
    email
  },
  defaults: {
    nickname, 
    password : hashpaw,
    salt:salt
  }
})
```

ë‹¤ì‹œí•œë²ˆ ë§í•˜ì§€ë§Œ, ìš°ë¦¬ê²Œ í•„ìš”í•œ ê²ƒì€ ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ì§‘ì–´ ë„£ê±°ë‚˜(`create` í•¨ìˆ˜), ë‹¨ìˆœíˆ ê¸°ì¡´ì— ê°€ì…ëœ ì´ë©”ì¼ê³¼ ì¤‘ë³µì¸ì§€ ì•„ë‹Œì§€ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒ(`find` í•¨ìˆ˜)ì´ ì•„ë‹ˆë¼ ë‘ê°œë¥¼ ë³µí•©ì ìœ¼ë¡œ í•´ì•¼í•  í•„ìš”ê°€ ìˆë‹¤. ê·¸ë˜ì„œ `findOrCreate`ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í–ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” **íŠ¹ì • ìš”ì†Œë¥¼ ê²€ìƒ‰í•˜ì—¬, ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ë°ì´í„°ë¥¼ DBì— ìƒˆë¡œ ìƒì„±**í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ë§Œì•½ ì¡´ì¬í•œë‹¤ë©´ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©°, í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤. 

`findOrCreate`ë¼ëŠ” í•¨ìˆ˜ì—ëŠ” ì—¬ëŸ¬ê°€ì§€ ì˜µì…˜ì´ ì¡´ì¬í•˜ëŠ”ë°, íŠ¹ì • ì¹¼ëŸ¼ì„ ê²€ìƒ‰í•´ì•¼í•˜ëŠ” `where`ì´ë¼ëŠ” ì˜µì…˜ê³¼ ê²€ìƒ‰ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°ì— ìƒˆë¡œ ìƒì„±ë˜ëŠ” ìš”ì†Œê°€ ê°’ëŠ” ê¸°ë³¸ ê°’ì„ `defaults` ì˜µì…˜ì„ ì‚¬ìš©í–ˆë‹¤. ë§Œì•½ ê²€ìƒ‰í•œ ì¹¼ëŸ¼ì— ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´  `where` ì˜µì…˜ì„ ì´ìš©í•´ ê²€ìƒ‰í–ˆë˜ ë‚´ìš©ì´ ê·¸ íŠ¹ì •ì¹¼ëŸ¼ì˜ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ëœë‹¤. ê·¸ë¦¬ê³  `defaults` ì˜µì…˜ì— ì˜í•´ì„œ nickname ì¹¼ëŸ¼ì—ëŠ” req.bodyì—ì„œ ë¹¼ì˜¨ `nickname`ì´ë¼ëŠ” ë³€ìˆ˜ì— ë“¤ì–´ê°„ ì •ë³´ë¥¼, passwordì¹¼ëŸ¼ì—ëŠ” `hashpaw`ë¼ëŠ” ë³€ìˆ˜ê°€, `salt` ì¹¼ëŸ¼ì—ëŠ” `salt` ë³€ìˆ˜ê°€ ë“¤ì–´ê°„ë‹¤.

```js
}).then(([data, created]) => {
  if (!created) {
    res.status(402).send("existed email");
  }
  else {
    res.status(201).json(data);
  }
})
```

ìœ„ ì½”ë“œì—ëŠ” `then` ë©”ì„œë“œëŠ” `data`ì™€ `created`ë¼ëŠ” 2ë¶€ë¶„ìœ¼ë¡œ ë‚˜ìš°ì–´ì§€ëŠ” ì½œë°±ì¸ìë¡œ ì „ë‹¬í•œë‹¤.  `data`ëŠ” DBì— ìƒì„±ë˜ëŠ” ë‚´ìš©ì´ê³ , `created`ëŠ” trueê°’ì„ ê°–ëŠ” ëŒ€í•œ boolean ë³€ìˆ˜ì´ë‹¤. ë§Œì•½ ì´ë¯¸ ìˆëŠ” ì´ë©”ì¼ì´ë©´ `created`ëŠ” true ê°’ì´ ë˜ì–´ "existed email" ë¬¸êµ¬ë¥¼ ì¶œë ¥í•˜ê²Œ ë  ê²ƒì´ë‹¤.

<br>

# 2. middlewares

join APIë¥¼ ì‘ì„±í•˜ë©´ì„œ ë‘ê°œì˜ ì—ëŸ¬ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í–ˆë‹¤.

- ë¹„ë°€ë²ˆí˜¸ì— ì˜ë¬¸ê³¼ ìˆ«ìê°€ í¬í•¨ë˜ì§€ ì•Šì•˜ì„ ê²½ìš° `403`
- ì´ë©”ì¼í˜•ì‹ì—ì„œ ì–´ê¸‹ë‚¬ì„ ê²½ìš° `403`

## 2.1 CheckPassword

**/middlewares/CheckPassword.js**

```js
const checkPassword = (paw) => {
  const pawNum = paw.search(/[0-9]/); // ë¹„ë°€ë²ˆí˜¸ì— ìˆ«ìê°€ ë“¤ì–´ê°€ëŠ”ì§€ ì•ˆ ë“¤ì–´ê°€ì§€ ì•Šìœ¼ë©´ -1 
  const pawEng = paw.search(/[a-zA-Z]/); // ë¹„ë°€ë²ˆí˜¸ì— ì˜ë¬¸ì´ ë“¤ì–´ê°€ëŠ”ì§€ ì•ˆ ë“¤ì–´ê°€ì§€ ì•Šìœ¼ë©´ -1 

  if (pawNum < 0 || pawEng < 0) {
    return false;
  }
  else {
    return true;
  }
}

module.exports = checkPassword;
```

ì…ë ¥ëœ string ê°ì²´ ì•ˆì—ì„œ ê·œì¹™ì„ ì°¾ìœ¼ë©´ ë˜ê¸° ë•Œë¬¸ì—  `search`ë¼ëŠ” ë©”ì†Œë“œë¥¼ ì‚¬ìš©í–ˆë‹¤. ([MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/String/search)ì°¸ê³ ) ë©”ê°œë³€ìˆ˜ë¡œ ë°›ì€ ë‚´ìš©ì´ ìŠ¤íŠ¸ë§ì— ìˆìœ¼ë©´ ì²«ë²ˆì§¸ ì¸ë±ìŠ¤ë¥¼ ë°˜í™˜í•˜ì§€ë§Œ, ì•„ë‹ˆë¼ë©´ -1ì„ ë°˜í™˜í•œë‹¤. 

## 2.2 CheckEmailForm

**/middlewares/CheckEmailForm.js**

```js
const checkEmailForm = (email) => {
  const emailCheck = /^([0-9a-zA-Z_\.-]+)@([0-9a-zA-Z_-]+)(\.[0-9a-zA-Z_-]+){1,2}$/;
    // ì´ë©”ì¼ í˜•ì‹ì—ëŠ” @ì™€ .ê°€ ê¼­ ë“¤ì–´ê°„ë‹¤. 
  if (!emailCheck.test(email)) {
    return false;
  }
  else {
    return true;
  }
}

module.exports = checkEmailForm;
```

`test`ë¼ëŠ” í•¨ìˆ˜ëŠ” ì£¼ì–´ì§„ ë¬¸ìì—´ì´ ì •ê·œí‘œí˜„ì‹ì— ë§Œì¡±í•˜ëŠ”ì§€ íŒë³„í•˜ê³  ê·¸ ê°’ì„ boolean ê°’ìœ¼ë¡œ ë‚˜íƒ€ë‚¸ë‹¤. ([MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/RegExp/test) ì°¸ê³ )

# 3. ì •ë¦¬ê°€ ëŠ¦ì€ ì´ìœ  ë° 10ê°„ í•œ ê²ƒ.

- ìš°ì„  ë°±ì‹  1ì°¨ë¥¼ ë§ê³  ì´í‹€ì •ë„ ê³¨ì•„ ë–¨ì–´ì ¸ìˆì—ˆë‹¤. ì™¼ì†ì´ ë¶“ê³  ê·¼ìœ¡í†µì´ ì‹¬í•´ ê±°ì˜ ëˆ„ì›Œìˆì—ˆë‹¤.
- ë‹¨ë°©í–¥ ì•”í˜¸í™”ë¥¼ ë¯¸ë“¤ì›¨ì–´ë¥¼ ë¹¼ê³ ì ë…¸ë ¥í–ˆëŠ”ë°.. ì¼ë‹¨ ë‹¤ë¥¸ APIë¥¼ ì‘ì„±í•´ë³´ê³  ìƒê°í•´ë´ì•¼ê² ë‹¤.
- APIë¥¼ ì‘ì„±í•˜ë©´ì„œ ì½ì€ ê¸€ì´ ë§ì•„ì„œ ì–´ë””ì„œë¶€í„° ì–´ë””ê¹Œì§€ ì‘ì„±í•´ì•¼í•˜ëŠ”ì§€ë¥¼ ëª°ë¼ í•œì°¸ì„ ê³ ë¯¼í–ˆë‹¤.
